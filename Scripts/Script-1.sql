
SELECT * FROM "USER";
SELECT * FROM CITY;
SELECT * FROM CITY_PHOTO;
SELECT * FROM DESTINATION;
SELECT * FROM "SCHEDULE";
SELECT * FROM DAYS;
SELECT * FROM DAYS_DETAIL;
SELECT * FROM POST;
SELECT * FROM POST_DETAIL;
SELECT * FROM REVIEW_DAYS;
SELECT * FROM REVIEW_PHOTO;
--SELECT * FROM COM_SUBMIT;
SELECT * FROM COM_APPLY;
--SELECT * FROM MESSAGE;
--SELECT * FROM MESSAGE_DETAIL;
SELECT * FROM RECOMMEND;

DROP SEQUENCE USER_SEQ;
DROP SEQUENCE CITY_SEQ;
DROP SEQUENCE DESTINATION_SEQ;
DROP SEQUENCE SCHEDULE_SEQ;
DROP SEQUENCE DAYS_SEQ;
DROP SEQUENCE POST_SEQ;
DROP SEQUENCE REVIEW_SEQ;
DROP SEQUENCE COMPANION_SEQ;
--DROP SEQUENCE MESSAGE_SEQ;

DROP TABLE "USER";
DROP TABLE CITY;
DROP TABLE CITY_PHOTO;
DROP TABLE DESTINATION;
DROP TABLE "SCHEDULE";
DROP TABLE DAYS;
DROP TABLE DAYS_DETAIL;
DROP TABLE POST;
DROP TABLE POST_DETAIL;
DROP TABLE REVIEW_DAYS;
DROP TABLE REVIEW_PHOTO;
--DROP TABLE COM_SUBMIT;
DROP TABLE COM_APPLY;
--DROP TABLE MESSAGE;
--DROP TABLE MESSAGE_DETAIL;
DROP TABLE RECOMMEND;


-- 사용자 : "USER"

CREATE SEQUENCE USER_SEQ
INCREMENT BY 1
START WITH 2
MINVALUE 1
NOMAXVALUE;

--이름, 성별, 이메일 not null취소 : (보류) 
--admin삭제, 로그인 타입(카톡은 1로/일반은 0 ) 으로 수정
--NickName 삭제
CREATE TABLE "USER"(
	USER_ID VARCHAR2(30) NOT NULL,
	USER_NAME VARCHAR2(30) NOT NULL,
	USER_PW VARCHAR2(40) NOT NULL,
	USER_GENDER VARCHAR2(10) NOT NULL,
	USER_AGE NUMBER(3) NOT NULL,
	USER_ADDRESS VARCHAR2(200),
	USER_EMAIL VARCHAR2(30) NOT NULL,
	USER_HP VARCHAR2(30) NOT NULL,
	USER_PHOTO VARCHAR2(100),
	USER_LOGIN_TYPE INT DEFAULT 0,
	CONSTRAINT USER_PK PRIMARY KEY (USER_ID),
	CONSTRAINT USER_NAME_CK CHECK(NOT REGEXP_LIKE(USER_NAME,'[:PUNCT:][:DIGIT:]')), 
	CONSTRAINT USER_ID_CK CHECK(REGEXP_LIKE(USER_ID,'[A-Za-z0-9]')), 
	CONSTRAINT USER_HP_CK CHECK(LENGTH(USER_HP) = 11 AND REGEXP_LIKE(USER_HP,'^[0-9]*$')), 
	CONSTRAINT USER_EMAIL_CK CHECK(USER_EMAIL LIKE '%@%'),
	CONSTRAINT USER_LOGIN_TYPE_CK CHECK(USER_LOGIN_TYPE IN(0, 1))
);

--test용
/*
INSERT INTO "USER"
(USER_ID, USER_NAME, USER_PW, USER_GENDER, USER_AGE, USER_ADDRESS, USER_EMAIL, USER_HP, USER_PHOTO, USER_LOGIN_TYPE)
VALUES('test01', '홍길동', '1234', '남자', 20, '역삼동', 'test01@gamil.com', '01012341234', '', 0);
*/

--select * from "USER";




-- 도시 : CITY
CREATE SEQUENCE CITY_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
NOMAXVALUE;


CREATE TABLE CITY(
   CITY_NUM INT NOT NULL,
   CITY_NAME VARCHAR2(40) NOT NULL,
   CITY_ENG_NAME VARCHAR2(40) NOT NULL,
   COUNTRY VARCHAR2(30) NOT NULL,
   WEATHER VARCHAR2(50),
   CONSTRAINT CITY_PK PRIMARY KEY (CITY_NUM)
);

CREATE TABLE CITY_PHOTO(
	CITY_PHOTO_NAME VARCHAR2(100) NOT NULL,
	CITY_NUM INT NOT NULL,
	CONSTRAINT CITY_PHOTO_PK PRIMARY KEY (CITY_PHOTO_NAME),
	CONSTRAINT CITY_PHOTO_FK FOREIGN KEY (CITY_NUM) REFERENCES CITY(CITY_NUM)
);

--SELECT * FROM city;
--SELECT * FROM CITY_PHOTO;

INSERT INTO CITY
(CITY_NUM, CITY_NAME, CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(1, '강릉','Gangneung' ,'대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(2, '광주','Gwangju' , '대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(3, '대구', 'Daegu' ,'대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(4, '대전', 'Daejeon' ,'대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(5, '부산','Busan' , '대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(6, '서귀포시','Seogwipo-si' , '대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(7, '서울', 'Seoul' ,'대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME,COUNTRY, WEATHER)
VALUES(8, '세종','Sejong' , '대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(9, '수원','Suwon' , '대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(10, '울산','Ulsan' , '대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(11, '인천','Incheon' , '대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(12, '제주시','Jeju-si' , '대한민국', '');
INSERT INTO CITY
(CITY_NUM, CITY_NAME,CITY_ENG_NAME, COUNTRY, WEATHER)
VALUES(13, '춘천','Chuncheon' , '대한민국', '');*/

--city photo 
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('강릉.jpg', 1);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('광주.jpg', 2);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('대구83타워전망대.jpg', 3);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('대전 엑스포.jpg', 4);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('부산2.jpg', 5);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('서귀포시 주상절리.jpg', 6);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('서울2.jpg', 7);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('세종시 풍경.jpg', 8);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('수원화성.jpg',9);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('울산.jpg', 10);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('인천 송도.jpg', 11);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('제주시 용눈이오름.jpg', 12);
INSERT INTO CITY_PHOTO
(CITY_PHOTO_NAME, CITY_NUM)
VALUES('춘천 의암호.jpg', 13);





-- 관광지 : DESTINATION
CREATE SEQUENCE DESTINATION_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
NOMAXVALUE;


CREATE TABLE DESTINATION(
   DESTINATION_NUM INT NOT NULL,
   DESTINATION_CITY_NUM INT NOT NULL,
   DESTINATION_CATEGORY_A VARCHAR2(10) NOT NULL,
   DESTINATION_NAME VARCHAR2(200) NOT NULL,
   DESTINATION_LONGITUDE NUMBER(12,9),
   DESTINATION_LATITUDE NUMBER(12,9),
   DESTINATION_ADDRESS VARCHAR2(200),
   DESTINATION_DESCRIPTION CLOB,
   DESTINATION_PHOTO VARCHAR2(200),
   DESTINATION_RECOMMEND_CNT INT NOT NULL,
   DESTINATION_STARS INT NOT NULL,
   CONSTRAINT DESTINATION_PK PRIMARY KEY (DESTINATION_NUM),
   CONSTRAINT DESTINATION_FK FOREIGN KEY (DESTINATION_CITY_NUM) REFERENCES CITY(CITY_NUM) ON DELETE CASCADE
);

--SELECT * FROM DESTINATION;
--SELECT COUNT(*) FROM DESTINATION; (2338개)


-- 일정 : "SCHEDULE"
CREATE SEQUENCE SCHEDULE_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
NOMAXVALUE;

CREATE TABLE "SCHEDULE"(
   SCHEDULE_NUM INT NOT NULL,
   SCHEDULE_NAME VARCHAR2(50) NOT NULL,
   SCHEDULE_USER_ID VARCHAR2(30) NOT NULL,
   SCHEDULE_CITY_NUM INT NOT NULL,
   SCHEDULE_DEPARTURE DATE,
   SCHEDULE_ARRIVAL DATE,
   SCHEDULE_TERM INT NOT NULL,
   SCHEDULE_OPEN_CHECK CHAR(1) DEFAULT '0',
   SCHEDULE_VIEWS INT DEFAULT 0,
   CONSTRAINT SCHEDULE_PK PRIMARY KEY (SCHEDULE_NUM),
   CONSTRAINT SCHEDULE_FK1 FOREIGN KEY (SCHEDULE_CITY_NUM) REFERENCES CITY(CITY_NUM) ON DELETE CASCADE,
   CONSTRAINT SCHEDULE_FK2 FOREIGN KEY (SCHEDULE_USER_ID) REFERENCES "USER"(USER_ID) ON DELETE CASCADE,
   CONSTRAINT SCHEDULE_OPEN_CHECK_CK CHECK(SCHEDULE_OPEN_CHECK IN('0','1'))
);

--test용
/*INSERT INTO SCHEDULE
(SCHEDULE_NUM, SCHEDULE_NAME, SCHEDULE_USER_ID, SCHEDULE_CITY_NUM, SCHEDULE_DEPARTURE, SCHEDULE_ARRIVAL, SCHEDULE_TERM, SCHEDULE_OPEN_CHECK, SCHEDULE_VIEWS)
VALUES(1, '강원도 여행', 'test01', 1, '2020-06-26', '2020-06-29', 4, '0', 0);
INSERT INTO SCHEDULE
(SCHEDULE_NUM, SCHEDULE_NAME, SCHEDULE_USER_ID, SCHEDULE_CITY_NUM, SCHEDULE_DEPARTURE, SCHEDULE_ARRIVAL, SCHEDULE_TERM, SCHEDULE_OPEN_CHECK, SCHEDULE_VIEWS)
VALUES(2, '광주 여행', 'test01', 1, '2020-06-29', '2020-06-30', 2, '0', 0);
INSERT INTO SCHEDULE
(SCHEDULE_NUM, SCHEDULE_NAME, SCHEDULE_USER_ID, SCHEDULE_CITY_NUM, SCHEDULE_DEPARTURE, SCHEDULE_ARRIVAL, SCHEDULE_TERM, SCHEDULE_OPEN_CHECK, SCHEDULE_VIEWS)
VALUES(3, '서울 여행', 'skbigks', 5, '2020-07-01', '2020-07-03', 3, '0', 0);*/

--SELECT * FROM SCHEDULE;



-- 일자 : DAYS
CREATE SEQUENCE DAYS_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1;

CREATE TABLE DAYS(
   DAYS_N INT NOT NULL,
   DAYS_SCHEDULE_NUM INT NOT NULL,
   DAYS_LIST_CHECK CHAR(1) DEFAULT '0',
   DAYS_COMPANION_CHECK CHAR(1) DEFAULT '0',
   CONSTRAINT DAYS_PK PRIMARY KEY (DAYS_N, DAYS_SCHEDULE_NUM),
   CONSTRAINT DAYS_FK FOREIGN KEY (DAYS_SCHEDULE_NUM) REFERENCES "SCHEDULE"(SCHEDULE_NUM) ON DELETE CASCADE,
   CONSTRAINT DAYS_LIST_CHECK_CK CHECK(DAYS_LIST_CHECK IN('0','1')),
   CONSTRAINT DAYS_COMPANION_CHECK_CK CHECK(DAYS_COMPANION_CHECK IN('0','1'))
);

--test용
/*INSERT INTO DAYS
(DAYS_N, DAYS_SCHEDULE_NUM, DAYS_LIST_CHECK, DAYS_COMPANION_CHECK)
VALUES(1, 1, '0', '0');
INSERT INTO DAYS
(DAYS_N, DAYS_SCHEDULE_NUM, DAYS_LIST_CHECK, DAYS_COMPANION_CHECK)
VALUES(1, 2, '0', '0');*/

--SELECT * FROM days;


-- 일자_상세 : DAYS_DETAIL
-- 전체 PK로 묶음 수정. 
CREATE TABLE DAYS_DETAIL(
   DAYS_DETAIL_N INT NOT NULL,
   DAYS_DETAIL_SCHEDULE_NUM INT NOT NULL,
   DAYS_DETAIL_DESTINATION_NUM INT NOT NULL,
   DAYS_DETAIL_ORDER INT NOT NULL,
   CONSTRAINT DAYS_DETAIL_PK PRIMARY KEY(DAYS_DETAIL_N, DAYS_DETAIL_SCHEDULE_NUM,DAYS_DETAIL_DESTINATION_NUM,DAYS_DETAIL_ORDER),
   CONSTRAINT DAYS_DETAIL_FK1 FOREIGN KEY (DAYS_DETAIL_N, DAYS_DETAIL_SCHEDULE_NUM)
   REFERENCES DAYS(DAYS_N, DAYS_SCHEDULE_NUM) ON DELETE CASCADE,
   CONSTRAINT DAYS_DETAIL_FK2 FOREIGN KEY (DAYS_DETAIL_DESTINATION_NUM)
   REFERENCES DESTINATION(DESTINATION_NUM) ON DELETE CASCADE
);

--test용
/*INSERT INTO DAYS_DETAIL
(DAYS_DETAIL_N, DAYS_DETAIL_SCHEDULE_NUM, DAYS_DETAIL_DESTINATION_NUM, DAYS_DETAIL_ORDER)
VALUES(1, 1, 1, 1);
INSERT INTO DAYS_DETAIL
(DAYS_DETAIL_N, DAYS_DETAIL_SCHEDULE_NUM, DAYS_DETAIL_DESTINATION_NUM, DAYS_DETAIL_ORDER)
VALUES(1, 1, 2, 2);
INSERT INTO DAYS_DETAIL
(DAYS_DETAIL_N, DAYS_DETAIL_SCHEDULE_NUM, DAYS_DETAIL_DESTINATION_NUM, DAYS_DETAIL_ORDER)
VALUES(1, 1, 1, 3);
INSERT INTO DAYS_DETAIL
(DAYS_DETAIL_N, DAYS_DETAIL_SCHEDULE_NUM, DAYS_DETAIL_DESTINATION_NUM, DAYS_DETAIL_ORDER)
VALUES(1, 2, 1, 1);
INSERT INTO DAYS_DETAIL
(DAYS_DETAIL_N, DAYS_DETAIL_SCHEDULE_NUM, DAYS_DETAIL_DESTINATION_NUM, DAYS_DETAIL_ORDER)
VALUES(1, 2, 1, 2);*/

--SELECT * FROM DAYS_DETAIL;


-- 게시물 : POST
CREATE SEQUENCE POST_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
NOMAXVALUE;

CREATE TABLE POST(
   POST_NUM INT NOT NULL,
   POST_USER_ID VARCHAR2(30) NOT NULL,
   POST_CITY_NUM INT NOT NULL,
   CONSTRAINT POST_PK PRIMARY KEY (POST_NUM),
   CONSTRAINT POST_FK1 FOREIGN KEY (POST_USER_ID) REFERENCES "USER"(USER_ID) ON DELETE CASCADE,
   CONSTRAINT POST_FK2 FOREIGN KEY (POST_CITY_NUM) REFERENCES CITY(CITY_NUM) ON DELETE CASCADE
);

CREATE TABLE POST_DETAIL(
   POST_NUM INT NOT NULL,
   POST_UPDATE_TIME DATE,
   POST_CONTENTS VARCHAR2(400),
   CONSTRAINT POST_DETAIL_PK PRIMARY KEY (POST_NUM),
   CONSTRAINT POST_DETAIL_FK FOREIGN KEY (POST_NUM) REFERENCES POST(POST_NUM) ON DELETE CASCADE
);

-- 후기 : REVIEW
CREATE SEQUENCE REVIEW_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
NOMAXVALUE;

--REVIEW_PHOTO VARCHAR2(200) 추가

CREATE TABLE REVIEW_DAYS(
	REVIEW_DAYS_N INT NOT NULL,
	REVIEW_DAYS_SCHEDULE_NUM INT NOT NULL,
	REVIEW_DAYS_NUM INT NOT NULL,
	REVIEW_DAYS_USER_ID VARCHAR2(30) NOT NULL,
	REVEIW_DAYS_TITLE VARCHAR2(60) NOT NULL,
	REVIEW_DAYS_CONTENT VARCHAR2(4000),
	REVIEW_DAYS_UPDATE_TIME DATE,
	REVIEW_DAYS_VIEWS INT DEFAULT 0,
	REVIEW_DAYS_OPEN_CHECK INT DEFAULT 0,
	CONSTRAINT REVIEW_DAYS_PK PRIMARY KEY (REVIEW_DAYS_N, REVIEW_DAYS_SCHEDULE_NUM),
	CONSTRAINT REVIEW_DAYS_FK1 FOREIGN KEY (REVIEW_DAYS_USER_ID) REFERENCES "USER"(USER_ID) ON DELETE CASCADE,
	CONSTRAINT REVIEW_DAYS_FK2 FOREIGN KEY (REVIEW_DAYS_N, REVIEW_DAYS_SCHEDULE_NUM)
	REFERENCES DAYS(DAYS_N, DAYS_SCHEDULE_NUM) ON DELETE CASCADE,
	CONSTRAINT REVIEW_DAYS_OPEN_CHECK_CK CHECK(REVIEW_DAYS_OPEN_CHECK IN(0, 1))
);


CREATE TABLE REVIEW_PHOTO(
	REVIEW_PHOTO_NAME VARCHAR2(100),
	REVIEW_DAYS_N INT NOT NULL,
	REVEIW_DAYS_SCHEDULE_NUM INT NOT NULL,
	CONSTRAINT REVIEW_PHOTO_PK PRIMARY KEY (REVIEW_PHOTO_NAME),
	CONSTRAINT REVIEW_PHOTO_FK FOREIGN KEY (REVIEW_DAYS_N, REVEIW_DAYS_SCHEDULE_NUM)
	REFERENCES REVIEW_DAYS(REVIEW_DAYS_N, REVIEW_DAYS_SCHEDULE_NUM) ON DELETE CASCADE
);

-- 동행 : COMPANION
CREATE SEQUENCE COMPANION_SEQ
INCREMENT BY 1
START WITH 1
MINVALUE 1
NOMAXVALUE;


CREATE TABLE COM_APPLY(
   COM_APPLY_NUM INT NOT NULL,
   COM_APPLY_DAYS_N INT NOT NULL,
   COM_APPLY_SCHEDULE_NUM INT NOT NULL,
   COM_APPLY_HOST_ID VARCHAR2(30) NOT NULL,
   COM_APPLY_MEMBER_ID VARCHAR2(30) NOT NULL,
   COM_APPLY_HOST_STATUS INT DEFAULT 0,
   COM_APPLY_MEMBER_STATUS INT DEFAULT 0,
   CONSTRAINT COM_APPLY_PK PRIMARY KEY (COM_APPLY_NUM),
   CONSTRAINT COM_APPLY_FK1 FOREIGN KEY (COM_APPLY_DAYS_N, COM_APPLY_SCHEDULE_NUM)
   REFERENCES DAYS(DAYS_N, DAYS_SCHEDULE_NUM) ON DELETE CASCADE,
   CONSTRAINT COM_APPLY_FK2 FOREIGN KEY (COM_APPLY_HOST_ID) REFERENCES "USER"(USER_ID) ON DELETE CASCADE,
   CONSTRAINT COM_APPLY_FK3 FOREIGN KEY (COM_APPLY_MEMBER_ID) REFERENCES "USER"(USER_ID) ON DELETE CASCADE
);


-- 추천 : RECOMMEND
CREATE TABLE RECOMMEND(
   RECOMMEND_USER_ID VARCHAR2(30) NOT NULL,
   RECOMMEND_DESTINATION_NUM INT NOT NULL,
   CONSTRAINT RECOMMEND_PK PRIMARY KEY (RECOMMEND_USER_ID, RECOMMEND_DESTINATION_NUM),
   CONSTRAINT RECOMMEND_FK1 FOREIGN KEY (RECOMMEND_USER_ID) REFERENCES "USER"(USER_ID) ON DELETE CASCADE,
   CONSTRAINT RECOMMEND_FK2 FOREIGN KEY (RECOMMEND_DESTINATION_NUM) REFERENCES DESTINATION(DESTINATION_NUM) ON DELETE CASCADE
);

ALTER TABLE DAYS ADD (DAYS_CITY_NUM NUMBER(22.0) );
